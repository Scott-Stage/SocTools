index=network_logs tag=dns message_type="RESPONSE" reply_code="NXDOMAIN"
| bucket _time span=1h
| stats count as nx_count by src_ip _time
| eventstats avg(nx_count) as avg_nx stdev(nx_count) as stdev_nx by src_ip
| where nx_count > (avg_nx + (3 * stdev_nx)) AND nx_count > 100
| eval outlier_label = src_ip + " (Anomaly Score: " + round((nx_count - avg_nx) / stdev_nx, 1) + ")"
| xyseries _time outlier_label nx_count
Why this works:
The Math: It performs the same Z-score filtering to find the bad IPs.
xyseries: This is the magic command. It takes the resulting table and pivots it so _time is the X-Axis, outlier_label (the IP) is the Legend, and nx_count is the Y-Axis.
Option 2: The "DGA Pattern" Chart (Scatter Plot)
DGA malware is distinct because it produces High Failure Counts AND High Uniqueness (it tries 1000 different random domains, not just 1000 requests to the same domain).
This visualization plots that relationship. DGA infections will appear in the top-right quadrant.
Visualization Type: Scatter Chart
X-Axis: unique_domains
Y-Axis: nx_count
code
Splunk
index=network_logs tag=dns message_type="RESPONSE" reply_code="NXDOMAIN"
| stats count as nx_count distinct_count(query) as unique_domains by src_ip
| eventstats avg(nx_count) as avg_nx stdev(nx_count) as stdev_nx
| eval is_outlier = if(nx_count > (avg_nx + (3 * stdev_nx)), "Critical", "Normal")
| search is_outlier="Critical"
| table src_ip nx_count unique_domains