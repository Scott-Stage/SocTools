// Program.cs
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddHttpContextAccessor();   // <-- REQUIRED

// if you use a delegating handler or services that need HttpContext:
builder.Services.AddTransient<TokenFromApiAuthHandler>();
builder.Services.AddHttpClient("GraphApi", http =>
{
    http.BaseAddress = new Uri("https://graph.microsoft.com/v1.0/");
    http.DefaultRequestHeaders.Accept.ParseAdd("application/json");
})
.AddHttpMessageHandler<TokenFromApiAuthHandler>();

builder.Services.AddScoped<MicrosoftGraphApiService>();
