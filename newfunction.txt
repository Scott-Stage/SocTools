public class DeviceService : IDeviceService
{
    private readonly IPowershellHandler _powershellHandler;

    public DeviceService(IPowershellHandler powershellHandler)
    {
        _powershellHandler = powershellHandler;
    }

    public async Task<List<Device>> GetAllAsync()
    {
        // Call your existing PowerShell function that returns JSON
        string json = await _powershellHandler.RunFunctionAsync("Get-AllDevices");

        if (string.IsNullOrWhiteSpace(json))
            return new List<Device>();

        // PowerShell returns a dictionary keyed by hostname
        var dict = JsonSerializer.Deserialize<Dictionary<string, Device>>(json,
            new JsonSerializerOptions
            {
                PropertyNameCaseInsensitive = true
            });

        return dict?.Values.ToList() ?? new List<Device>();
    }
}
