builder.Services
    .AddAuthentication(OpenIdConnectDefaults.AuthenticationScheme)
    .AddMicrosoftIdentityWebApp(options =>
    {
        options.Instance     = "https://login.microsoftonline.com/";
        options.TenantId     = tenantIdFromSqlite;
        options.ClientId     = clientIdFromSqlite;
        options.ClientSecret = clientSecretFromSqlite;
        options.CallbackPath = "/signin-oidc";
        options.UsePkce      = true;

        // request delegated Graph scopes
        options.Scope.Add("openid");
        options.Scope.Add("profile");
        options.Scope.Add("offline_access");
        options.Scope.Add("https://graph.microsoft.com/User.Read");
        options.Scope.Add("https://graph.microsoft.com/eDiscovery.Read.All");
    })
    .EnableTokenAcquisitionToCallDownstreamApi()
    .AddMicrosoftGraph(scopes: new[] { "User.Read", "eDiscovery.Read.All" })
    .AddInMemoryTokenCaches();
